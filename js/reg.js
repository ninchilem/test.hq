"use strict";function ajax(e){var n={method:"get",url:"#",params:"",callback:null,isAsync:!0};for(var s in e)n[s]=e[s];var t=new XMLHttpRequest,a=n.url;"get"==n.method.toLowerCase()&&""!=n.params&&(a+="?"+n.params),t.open(n.method,a,n.isAsync),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&n.callback&&n.callback(t.responseText)},"get"==n.method.toLowerCase()?t.send():"post"==n.method.toLowerCase()&&(t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(n.params))}var isRight=[0,0,0,0],oUser=document.getElementById("userId"),oPass=document.getElementById("passId"),oPass2=document.getElementById("pass2Id"),oBtnReg=document.getElementById("btnReg");function isUser(){/^[_a-zA-Z]\w{5,15}$/.test(oUser.value)?(isRight[0]=1,oUser.nextElementSibling.innerHTML="√"):(isRight[0]=0,oUser.nextElementSibling.innerHTML="×,用户名格式错误")}function hasUser(){ajax({url:"checkUsername.php",params:"user_name="+oUser.value,callback:function(e){"1"==e?(isRight[3]=0,oUser.nextElementSibling.innerHTML="已存在的用户名"):"0"==e&&(isRight[3]=1,oUser.nextElementSibling.innerHTML="可使用的用户名")}})}function isPass(){/^[\da-zA-Z]{6,16}$/.test(oPass.value)?(isRight[1]=1,oPass.nextElementSibling.innerHTML="√"):(isRight[1]=0,oPass.nextElementSibling.innerHTML="×，请输入正确的密码格式")}function isPass2(){if(!/^[\da-zA-Z]{6,16}$/.test(oPass2.value))return isRight[2]=0,void(oPass2.nextElementSibling.innerHTML="×，请输入正确的密码格式");isRight[2]=1,oPass2.nextElementSibling.innerHTML="√",oPass2.value==oPass.value?(isRight[2]=1,oPass2.nextElementSibling.innerHTML="√"):(isRight[2]=0,oPass2.nextElementSibling.innerHTML="×，两次密码不一致")}oUser.onblur=function(){isUser(),1==isRight[0]&&hasUser()},oPass.onblur=function(){isPass()},oPass.onchange=function(){isRight[2]=0,isPass2()},oPass2.onblur=function(){isPass2()},oBtnReg.onclick=function(){var n=0;isRight.forEach(function(e){n+=e}),4==n?ajax({method:"post",url:"regSave.php",params:"user_name=".concat(oUser.value,"&password=").concat(oPass.value),callback:function(e){"1"==e?document.getElementById("messagebox").innerHTML="注册成功，请<a href='mi_dm.html'>登录</a>":"0"==e&&(document.getElementById("messagebox").innerHTML="注册失败！")}}):document.getElementById("messagebox").innerHTML="信息填写不完整"};